<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ | SODmAX Pro</title>
    
    <!-- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ -->
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ */
        .dashboard {
            padding: 20px 0;
        }
        
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-item {
            background: linear-gradient(145deg, var(--card) 0%, rgba(18, 24, 40, 0.95) 100%);
            border-radius: var(--radius-lg);
            padding: 25px;
            border: 1px solid var(--glass-border);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
            color: white;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 900;
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: var(--card);
            border-radius: var(--radius-lg);
            padding: 25px;
            border: 1px solid var(--glass-border);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 700;
        }
        
        .recent-activity {
            background: var(--card);
            border-radius: var(--radius-lg);
            padding: 25px;
            border: 1px solid var(--glass-border);
            margin-bottom: 40px;
        }
        
        .activity-list {
            margin-top: 20px;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            background: rgba(0, 102, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--primary);
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .activity-time {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .quick-action-btn {
            background: var(--card);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quick-action-btn:hover {
            background: rgba(0, 102, 255, 0.1);
            border-color: var(--primary);
            transform: translateY(-3px);
        }
        
        .quick-action-icon {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        @media (max-width: 768px) {
            .stats-overview {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Ù†Ø§ÙˆØ¨Ø±ÛŒ -->
    <nav class="navbar">
        <div class="container nav-content">
            <a href="index.html" class="logo">
                <div class="logo-icon">â›ï¸</div>
                <div class="logo-text">
                    <h1>SODmAX Pro</h1>
                    <p>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ú©Ø§Ø±Ø¨Ø±ÛŒ</p>
                </div>
            </a>
            
            <div style="display: flex; gap: 10px; align-items: center;">
                <a href="index.html" class="btn btn-outline btn-small">
                    <i class="fas fa-home"></i> ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
                </a>
                <a href="leaderboard.html" class="btn btn-outline btn-small">
                    <i class="fas fa-trophy"></i> Ù„ÛŒØ¯Ø±Ø¨Ø±Ø¯
                </a>
                <button onclick="logout()" class="btn btn-small" style="background: rgba(255,107,53,0.2); color: var(--accent);">
                    <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ -->
    <div class="container dashboard">
        <!-- Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
        <div class="card" style="margin-bottom: 30px; text-align: center;">
            <h2 style="margin-bottom: 10px;">ğŸ‘‹ Ø³Ù„Ø§Ù…ØŒ <span id="userName">Ú©Ø§Ø±Ø¨Ø±</span>!</h2>
            <p style="color: var(--text-secondary);">Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø´Ø®ØµÛŒ Ø®ÙˆØ¯ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯. Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØªÙ…Ø§Ù… ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯.</p>
        </div>
        
        <!-- Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
        <div class="stats-overview">
            <div class="stat-item">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-value" id="totalEarnings">Û°</div>
                <div class="stat-label">Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯ SOD</div>
            </div>
            
            <div class="stat-item">
                <div class="stat-icon">ğŸ’</div>
                <div class="stat-value" id="totalUSDT">Û°</div>
                <div class="stat-label">Ú©Ù„ USDT Ú©Ø³Ø¨ Ø´Ø¯Ù‡</div>
            </div>
            
            <div class="stat-item">
                <div class="stat-icon">âš¡</div>
                <div class="stat-value" id="miningPower">Û±Û°x</div>
                <div class="stat-label">Ù‚Ø¯Ø±Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬</div>
            </div>
            
            <div class="stat-item">
                <div class="stat-icon">â­</div>
                <div class="stat-value" id="userLevel">Û±</div>
                <div class="stat-label">Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø±ÛŒ</div>
            </div>
        </div>
        
        <!-- Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ -->
        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">ğŸ“ˆ Ø±Ø´Ø¯ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
                    <select id="timeRange" onchange="updateChart()" style="background: var(--glass); border: 1px solid var(--glass-border); color: white; padding: 5px 10px; border-radius: 6px;">
                        <option value="7">Û· Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡</option>
                        <option value="30">Û³Û° Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡</option>
                        <option value="90">Û¹Û° Ø±ÙˆØ² Ú¯Ø°Ø´ØªÙ‡</option>
                    </select>
                </div>
                <div id="growthChart" style="height: 200px; display: flex; align-items: flex-end; gap: 10px; padding: 20px 0;">
                    <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">ğŸ¯ Ù¾ÛŒØ´Ø±ÙØª USDT</h3>
                </div>
                <div style="text-align: center; padding: 20px 0;">
                    <div style="font-size: 48px; color: var(--usdt); margin-bottom: 10px;">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div style="font-size: 24px; font-weight: 900; margin-bottom: 10px;" id="usdtProgress">Û°.Û°Û°Û°Û°</div>
                    <div style="color: var(--text-secondary);">USDT Ù‚Ø§Ø¨Ù„ Ø¯Ø±ÛŒØ§ÙØª</div>
                    <div class="progress-bar" style="margin: 20px 0; height: 8px;">
                        <div class="progress-fill" id="usdtProgressBar"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary);">
                        <span>Û°</span>
                        <span id="nextRewardGoal">Û±,Û°Û°Û°,Û°Û°Û° SOD</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± -->
        <div class="recent-activity">
            <h3 style="margin-bottom: 5px;">ğŸ“‹ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h3>
            <p style="color: var(--text-secondary); font-size: 14px;">Ø¢Ø®Ø±ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ Ùˆ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§</p>
            
            <div class="activity-list" id="activityList">
                <!-- ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                <div class="activity-item">
                    <div class="activity-icon">â³</div>
                    <div class="activity-content">
                        <div style="color: var(--text-secondary); text-align: center; padding: 20px;">
                            Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§...
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="loadMoreActivities()" class="btn btn-outline btn-small">
                    <i class="fas fa-sync-alt"></i> Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ±
                </button>
            </div>
        </div>
        
        <!-- Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹ -->
        <div style="margin-bottom: 40px;">
            <h3 style="margin-bottom: 20px;">ğŸš€ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø³Ø±ÛŒØ¹</h3>
            <div class="quick-actions">
                <div class="quick-action-btn" onclick="window.location.href='index.html#miner'">
                    <div class="quick-action-icon">â›ï¸</div>
                    <div>Ø§Ø³ØªØ®Ø±Ø§Ø¬</div>
                </div>
                
                <div class="quick-action-btn" onclick="buySOD()">
                    <div class="quick-action-icon">ğŸ›’</div>
                    <div>Ø®Ø±ÛŒØ¯ SOD</div>
                </div>
                
                <div class="quick-action-btn" onclick="claimRewards()">
                    <div class="quick-action-icon">ğŸ’</div>
                    <div>Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø¯Ø§Ø´</div>
                </div>
                
                <div class="quick-action-btn" onclick="window.location.href='missions.html'">
                    <div class="quick-action-icon">ğŸ¯</div>
                    <div>Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§</div>
                </div>
                
                <div class="quick-action-btn" onclick="inviteFriends()">
                    <div class="quick-action-icon">ğŸ‘¥</div>
                    <div>Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³ØªØ§Ù†</div>
                </div>
                
                <div class="quick-action-btn" onclick="showSettings()">
                    <div class="quick-action-icon">âš™ï¸</div>
                    <div>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</div>
                </div>
            </div>
        </div>
        
        <!-- ÙˆØ¶Ø¹ÛŒØª Ø­Ø³Ø§Ø¨ -->
        <div class="card">
            <h3 style="margin-bottom: 20px;">ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø­Ø³Ø§Ø¨</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div>
                    <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 5px;">ØªØ§Ø±ÛŒØ® Ø¹Ø¶ÙˆÛŒØª</div>
                    <div style="font-weight: 600;" id="joinDate">--</div>
                </div>
                
                <div>
                    <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 5px;">Ú©Ø¯ Ø¯Ø¹ÙˆØª</div>
                    <div style="font-weight: 600; font-family: monospace;" id="inviteCode">--</div>
                </div>
                
                <div>
                    <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 5px;">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø¹ÙˆØª Ø´Ø¯Ù‡</div>
                    <div style="font-weight: 600;" id="referralCount">Û° Ù†ÙØ±</div>
                </div>
                
                <div>
                    <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 5px;">Ø±ØªØ¨Ù‡ Ø¯Ø± Ù„ÛŒØ¯Ø±Ø¨Ø±Ø¯</div>
                    <div style="font-weight: 600;" id="leaderboardRank">--</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="utils.js"></script>
    
    <script>
        // ==================== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ ====================
        let currentUser = null;
        let gameData = null;
        let userInfo = null;
        let activities = [];
        
        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        
        async function initDashboard() {
            try {
                // Ø¨Ø±Ø±Ø³ÛŒ session
                const { data: { session } } = await window.supabaseClient.auth.getSession();
                
                if (!session) {
                    window.location.href = 'index.html';
                    return;
                }
                
                currentUser = session.user;
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
                await loadUserData();
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
                await loadActivities();
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                updateDashboard();
                
                console.log('âœ… Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯:', error);
                showError('Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù¾ÛŒØ´ Ø¢Ù…Ø¯');
            }
        }
        
        async function loadUserData() {
            try {
                // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
                const { data: userData, error: userError } = await window.supabaseClient
                    .from('users')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (userError) throw userError;
                userInfo = userData;
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒ
                const { data: gameDataResult, error: gameError } = await window.supabaseClient
                    .from('game_data')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .single();
                
                if (gameError) throw gameError;
                gameData = gameDataResult;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª:', error);
                throw error;
            }
        }
        
        async function loadActivities() {
            try {
                // Ø¯Ø±ÛŒØ§ÙØª ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±
                const { data, error } = await window.supabaseClient
                    .from('transactions')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                if (error) throw error;
                activities = data || [];
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§:', error);
                activities = [];
            }
        }
        
        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI ====================
        
        function updateDashboard() {
            if (!userInfo || !gameData) return;
            
            // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
            document.getElementById('userName').textContent = userInfo.full_name || userInfo.email.split('@')[0];
            document.getElementById('joinDate').textContent = userInfo.register_date || '--';
            document.getElementById('inviteCode').textContent = userInfo.invite_code || '--';
            
            // Ø¢Ù…Ø§Ø±
            document.getElementById('totalEarnings').textContent = window.NumberUtils.formatNumber(gameData.total_mined || 0);
            document.getElementById('totalUSDT').textContent = (gameData.usdt_balance || 0).toFixed(4);
            document.getElementById('miningPower').textContent = (gameData.mining_power || 10) + 'x';
            document.getElementById('userLevel').textContent = gameData.user_level || 1;
            
            // Ù¾ÛŒØ´Ø±ÙØª USDT
            const progressPercent = Math.min(((gameData.usdt_progress || 0) / 1000000) * 100, 100);
            document.getElementById('usdtProgressBar').style.width = progressPercent + '%';
            document.getElementById('usdtProgress').textContent = (gameData.usdt_balance || 0).toFixed(4);
            document.getElementById('nextRewardGoal').textContent = window.NumberUtils.formatNumber(1000000 - (gameData.usdt_progress || 0)) + ' SOD';
            
            // ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§
            renderActivities();
            
            // Ù†Ù…ÙˆØ¯Ø§Ø± Ø±Ø´Ø¯
            renderGrowthChart();
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±ØªØ¨Ù‡
            updateLeaderboardRank();
        }
        
        function renderActivities() {
            const container = document.getElementById('activityList');
            
            if (!activities.length) {
                container.innerHTML = `
                    <div class="activity-item">
                        <div class="activity-icon">ğŸ“­</div>
                        <div class="activity-content">
                            <div class="activity-title">Ù‡Ù†ÙˆØ² ÙØ¹Ø§Ù„ÛŒØªÛŒ Ø«Ø¨Øª Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯</div>
                            <div class="activity-time">Ø¨Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯!</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            activities.forEach(activity => {
                const icon = getActivityIcon(activity.type, activity.amount);
                const amount = activity.type === 'usdt' 
                    ? `${activity.amount > 0 ? '+' : ''}${Math.abs(activity.amount).toFixed(4)} USDT`
                    : `${activity.amount > 0 ? '+' : ''}${window.NumberUtils.formatNumber(activity.amount)} SOD`;
                
                const color = activity.amount > 0 ? 'var(--success)' : 'var(--error)';
                
                html += `
                    <div class="activity-item">
                        <div class="activity-icon">${icon}</div>
                        <div class="activity-content">
                            <div class="activity-title">${activity.description}</div>
                            <div class="activity-time">${window.NumberUtils.formatTimeAgo(activity.created_at)}</div>
                        </div>
                        <div style="font-weight: 700; color: ${color};">${amount}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function getActivityIcon(type, amount) {
            if (type === 'usdt') {
                return amount > 0 ? 'ğŸ’°' : 'ğŸ’¸';
            } else {
                if (amount > 0) return 'â›ï¸';
                if (amount < 0) return 'ğŸ“¤';
                return 'ğŸ“Š';
            }
        }
        
        function renderGrowthChart() {
            const container = document.getElementById('growthChart');
            
            // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
            const days = 7;
            const data = [];
            
            for (let i = days; i >= 1; i--) {
                const dayEarnings = Math.floor(Math.random() * 10000) + 5000;
                data.push({
                    day: i,
                    earnings: dayEarnings
                });
            }
            
            const maxEarnings = Math.max(...data.map(d => d.earnings));
            
            let html = '';
            data.forEach(item => {
                const height = (item.earnings / maxEarnings) * 150;
                html += `
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                        <div style="width: 20px; background: var(--gradient); border-radius: 10px 10px 0 0; height: ${height}px;"></div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">${item.day} Ø±ÙˆØ² Ù¾ÛŒØ´</div>
                        <div style="font-size: 11px; color: var(--text); margin-top: 2px;">${window.NumberUtils.formatNumber(item.earnings)}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        async function updateLeaderboardRank() {
            try {
                const { data: allUsers } = await window.supabaseClient
                    .from('game_data')
                    .select('total_mined, user_id')
                    .order('total_mined', { ascending: false });
                
                if (allUsers) {
                    const rank = allUsers.findIndex(user => user.user_id === currentUser.id) + 1;
                    document.getElementById('leaderboardRank').textContent = `#${rank}`;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø±ØªØ¨Ù‡:', error);
            }
        }
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ ====================
        
        function buySOD() {
            window.location.href = 'index.html#sale';
        }
        
        async function claimRewards() {
            if (!gameData || !gameData.usdt_balance || gameData.usdt_balance <= 0) {
                showMessage('Ù‡Ù†ÙˆØ² USDT Ù¾Ø§Ø¯Ø§Ø´ Ø¯Ø±ÛŒØ§ÙØª Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯', 'info');
                return;
            }
            
            try {
                // Ø§ÛŒÙ†Ø¬Ø§ Ù…Ù†Ø·Ù‚ Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø¯Ø§Ø´ Ø§Ø² index.html Ú©Ù¾ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                showMessage('Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„...', 'info');
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ
                setTimeout(() => {
                    showMessage(`${gameData.usdt_balance.toFixed(4)} USDT Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯!`, 'success');
                }, 1500);
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø¯Ø§Ø´:', error);
                showError('Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø¯Ø§Ø´ Ù¾ÛŒØ´ Ø¢Ù…Ø¯');
            }
        }
        
        async function inviteFriends() {
            if (!userInfo || !userInfo.invite_code) {
                showError('Ú©Ø¯ Ø¯Ø¹ÙˆØª ÛŒØ§ÙØª Ù†Ø´Ø¯');
                return;
            }
            
            const inviteLink = `${window.location.origin}/index.html?ref=${userInfo.invite_code}`;
            const message = `ğŸ‰ Ø¨Ù‡ SODmAX Pro Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯ Ùˆ SOD Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯!\n\n` +
                          `ğŸ”— Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª: ${inviteLink}\n` +
                          `ğŸ Ú©Ø¯ Ø¯Ø¹ÙˆØª: ${userInfo.invite_code}\n\n` +
                          `â›ï¸ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø§ Ù¾Ø§Ø¯Ø§Ø´ ÙˆØ§Ù‚Ø¹ÛŒ USDT`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'SODmAX Pro - Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³ØªØ§Ù†',
                        text: message,
                        url: inviteLink
                    });
                    showMessage('Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ú¯Ø°Ø§Ø´ØªÙ‡ Ø´Ø¯', 'success');
                } catch (error) {
                    copyToClipboard(inviteLink);
                }
            } else {
                copyToClipboard(inviteLink);
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ú©Ù¾ÛŒ Ø´Ø¯!', 'success');
            }).catch(() => {
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showMessage('Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª Ú©Ù¾ÛŒ Ø´Ø¯!', 'success');
            });
        }
        
        function showSettings() {
            const settings = `
                <div style="padding: 20px;">
                    <h3 style="margin-bottom: 20px;">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø­Ø³Ø§Ø¨</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 5px;">Ù†Ø§Ù… Ù†Ù…Ø§ÛŒØ´ÛŒ</div>
                        <input type="text" id="displayName" value="${userInfo.full_name || ''}" style="width: 100%; padding: 10px; background: var(--glass); border: 1px solid var(--glass-border); border-radius: 8px; color: white;">
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 25px;">
                        <button onclick="saveSettings()" style="flex: 1; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Ø°Ø®ÛŒØ±Ù‡
                        </button>
                        <button onclick="closeModal()" style="flex: 1; padding: 12px; background: var(--glass); color: white; border: 1px solid var(--glass-border); border-radius: 8px; cursor: pointer;">
                            Ø§Ù†ØµØ±Ø§Ù
                        </button>
                    </div>
                </div>
            `;
            
            showModal('ØªÙ†Ø¸ÛŒÙ…Ø§Øª', settings);
        }
        
        async function saveSettings() {
            const displayName = document.getElementById('displayName').value;
            
            try {
                await window.supabaseClient
                    .from('users')
                    .update({ full_name: displayName })
                    .eq('id', currentUser.id);
                
                userInfo.full_name = displayName;
                updateDashboard();
                closeModal();
                showMessage('ØªØºÛŒÛŒØ±Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª:', error);
                showError('Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´ Ø¢Ù…Ø¯');
            }
        }
        
        async function logout() {
            try {
                await window.supabaseClient.auth.signOut();
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬:', error);
            }
        }
        
        function updateChart() {
            renderGrowthChart();
        }
        
        function loadMoreActivities() {
            // Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø¨Ø§ÛŒØ¯ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¨ÛŒØ´ØªØ± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†Ø¯
            showMessage('Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±...', 'info');
            setTimeout(() => {
                showMessage('Ù‡Ù…Ù‡ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯', 'info');
            }, 1000);
        }
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
        
        function showMessage(message, type = 'info') {
            const colors = {
                success: '#00C853',
                error: '#FF3D00',
                info: '#0066FF',
                warning: '#FFB300'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--card);
                border: 1px solid var(--glass-border);
                border-left: 4px solid ${colors[type] || colors.info};
                border-radius: var(--radius);
                padding: 15px 20px;
                display: flex;
                align-items: center;
                gap: 15px;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 400px;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 20px;">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</div>
                <div>
                    <div style="font-weight: bold;">${type === 'success' ? 'Ù…ÙˆÙÙ‚ÛŒØª' : type === 'error' ? 'Ø®Ø·Ø§' : type === 'warning' ? 'Ù‡Ø´Ø¯Ø§Ø±' : 'Ø§Ø·Ù„Ø§Ø¹'}</div>
                    <div style="color: var(--text-secondary); font-size: 14px;">${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function showError(message) {
            showMessage(message, 'error');
        }
        
        function showModal(title, content) {
            // Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù‚Ø¨Ù„ÛŒ
            const existing = document.getElementById('customModal');
            if (existing) existing.remove();
            
            const modal = document.createElement('div');
            modal.id = 'customModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10001;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--card); border-radius: var(--radius-lg); width: 100%; max-width: 500px; border: 1px solid var(--glass-border); animation: fadeIn 0.3s ease;">
                    <div style="padding: 20px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0;">${title}</h3>
                        <button onclick="closeModal()" style="background: none; border: none; color: var(--text-secondary); font-size: 20px; cursor: pointer;">Ã—</button>
                    </div>
                    ${content}
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
            if (!document.querySelector('#modal-animations')) {
                const style = document.createElement('style');
                style.id = 'modal-animations';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; transform: scale(0.9); }
                        to { opacity: 1; transform: scale(1); }
                    }
                    @keyframes slideIn {
                        from { transform: translateX(100%); }
                        to { transform: translateX(0); }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); }
                        to { transform: translateX(100%); }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function closeModal() {
            const modal = document.getElementById('customModal');
            if (modal) modal.remove();
        }
        
        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            initDashboard();
            
            // Ø±ÙØ±Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
            setInterval(() => {
                if (currentUser) {
                    loadUserData().then(updateDashboard);
                }
            }, 30000);
        });
    </script>
</body>
</html>
