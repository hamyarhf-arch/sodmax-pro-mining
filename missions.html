<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ | SODmAX Pro</title>
    
    <!-- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ -->
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ */
        .missions {
            padding: 20px 0;
        }
        
        .missions-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .missions-title {
            font-size: 32px;
            font-weight: 900;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .missions-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .mission-tab {
            padding: 12px 24px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .mission-tab.active {
            background: var(--gradient);
            color: white;
            border-color: transparent;
        }
        
        .missions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .mission-card {
            background: linear-gradient(145deg, var(--card) 0%, rgba(18, 24, 40, 0.95) 100%);
            border-radius: var(--radius-lg);
            padding: 25px;
            border: 1px solid var(--glass-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .mission-card.featured {
            border: 2px solid var(--primary);
            background: linear-gradient(145deg, var(--card) 0%, rgba(0, 102, 255, 0.15) 100%);
        }
        
        .mission-card.completed {
            opacity: 0.8;
            border-color: var(--success);
        }
        
        .mission-card.claimed {
            opacity: 0.6;
            background: linear-gradient(145deg, var(--card) 0%, rgba(148, 163, 184, 0.1) 100%);
        }
        
        .mission-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-daily {
            background: var(--gradient);
            color: white;
        }
        
        .badge-weekly {
            background: var(--gradient-usdt);
            color: white;
        }
        
        .badge-special {
            background: linear-gradient(135deg, var(--accent) 0%, #FF5722 100%);
            color: white;
        }
        
        .mission-header {
            margin-bottom: 20px;
            padding-top: 10px;
        }
        
        .mission-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .mission-description {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .mission-reward {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 102, 255, 0.1);
            border-radius: var(--radius);
        }
        
        .reward-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
        }
        
        .reward-info {
            flex: 1;
        }
        
        .reward-title {
            font-weight: 600;
            font-size: 14px;
        }
        
        .reward-amount {
            font-size: 20px;
            font-weight: 900;
            margin-top: 5px;
        }
        
        .mission-progress {
            margin: 20px 0;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .progress-bar {
            height: 8px;
            background: var(--glass);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .mission-actions {
            margin-top: 25px;
        }
        
        .mission-btn {
            width: 100%;
            padding: 12px;
            border-radius: var(--radius);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-start {
            background: var(--gradient);
            color: white;
        }
        
        .btn-claim {
            background: var(--gradient-usdt);
            color: white;
        }
        
        .btn-disabled {
            background: var(--glass);
            color: var(--text-secondary);
            cursor: not-allowed;
        }
        
        .btn-completed {
            background: rgba(0, 200, 83, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }
        
        .missions-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }
        
        .stat-icon {
            font-size: 32px;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 900;
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .missions-grid {
                grid-template-columns: 1fr;
            }
            
            .missions-tabs {
                justify-content: center;
            }
            
            .missions-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Ù†Ø§ÙˆØ¨Ø±ÛŒ -->
    <nav class="navbar">
        <div class="container nav-content">
            <a href="index.html" class="logo">
                <div class="logo-icon">â›ï¸</div>
                <div class="logo-text">
                    <h1>SODmAX Pro</h1>
                    <p>Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ Ùˆ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§</p>
                </div>
            </a>
            
            <div style="display: flex; gap: 10px; align-items: center;">
                <a href="index.html" class="btn btn-outline btn-small">
                    <i class="fas fa-home"></i> ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
                </a>
                <a href="dashboard.html" class="btn btn-outline btn-small">
                    <i class="fas fa-chart-line"></i> Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                </a>
                <a href="leaderboard.html" class="btn btn-outline btn-small">
                    <i class="fas fa-trophy"></i> Ù„ÛŒØ¯Ø±Ø¨Ø±Ø¯
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ -->
    <div class="container missions">
        <!-- Ù‡Ø¯Ø± -->
        <div class="missions-header">
            <h1 class="missions-title">ğŸ¯ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ Ùˆ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§</h1>
            <p style="color: var(--text-secondary); max-width: 600px; margin: 0 auto;">
                Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒØ¯ Ùˆ Ù¾Ø§Ø¯Ø§Ø´â€ŒÙ‡Ø§ÛŒ ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯. Ù‡Ø± Ø±ÙˆØ² Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯!
            </p>
        </div>
        
        <!-- ØªØ¨â€ŒÙ‡Ø§ -->
        <div class="missions-tabs">
            <button class="mission-tab active" onclick="filterMissions('all')">
                <i class="fas fa-list"></i> Ù‡Ù…Ù‡
            </button>
            <button class="mission-tab" onclick="filterMissions('daily')">
                <i class="fas fa-calendar-day"></i> Ø±ÙˆØ²Ø§Ù†Ù‡
            </button>
            <button class="mission-tab" onclick="filterMissions('weekly')">
                <i class="fas fa-calendar-week"></i> Ù‡ÙØªÚ¯ÛŒ
            </button>
            <button class="mission-tab" onclick="filterMissions('special')">
                <i class="fas fa-crown"></i> ÙˆÛŒÚ˜Ù‡
            </button>
            <button class="mission-tab" onclick="filterMissions('completed')">
                <i class="fas fa-check-circle"></i> ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡
            </button>
        </div>
        
        <!-- Ø¢Ù…Ø§Ø± -->
        <div class="missions-stats">
            <div class="stat-card">
                <div class="stat-icon">ğŸ†</div>
                <div class="stat-value" id="completedMissions">Û°</div>
                <div class="stat-label">Ù…Ø£Ù…ÙˆØ±ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-value" id="totalRewards">Û° SOD</div>
                <div class="stat-label">Ú©Ù„ Ù¾Ø§Ø¯Ø§Ø´â€ŒÙ‡Ø§</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">âš¡</div>
                <div class="stat-value" id="activeMissions">Û°</div>
                <div class="stat-label">Ù…Ø£Ù…ÙˆØ±ÛŒØª ÙØ¹Ø§Ù„</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ</div>
                <div class="stat-value" id="availableRewards">Û°</div>
                <div class="stat-label">Ù¾Ø§Ø¯Ø§Ø´ Ù‚Ø§Ø¨Ù„ Ø¯Ø±ÛŒØ§ÙØª</div>
            </div>
        </div>
        
      
    <!-- Ú¯Ø±ÛŒ        <!-- Ù„ÛŒØ³Øª Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ -->
        <div class="missions-grid" id="missionsList">
            <!-- Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            <div class="mission-card" style="text-align: center; padding: 40px;">
                <div class="loader"></div>
                <div style="margin-top: 20px; color: var(--text-secondary);">
                    Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§...
                </div>
            </div>
        </div>
        
        <!-- Ù…Ø£Ù…ÙˆØ±ÛŒØª ÙˆÛŒÚ˜Ù‡ Ø±ÙˆØ² -->
        <div class="card" style="margin: 40px 0; border: 2px solid var(--primary); background: linear-gradient(145deg, var(--card) 0%, rgba(0, 102, 255, 0.15) 100%);">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <div style="width: 50px; height: 50px; background: var(--gradient); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white;">
                    ğŸ‘‘
                </div>
                <div>
                    <h3 style="margin-bottom: 5px;">Ù…Ø£Ù…ÙˆØ±ÛŒØª ÙˆÛŒÚ˜Ù‡ Ø§Ù…Ø±ÙˆØ²</h3>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        ÙÙ‚Ø· Ø§Ù…Ø±ÙˆØ²! Ù¾Ø§Ø¯Ø§Ø´ Ø¯ÙˆØ¨Ø±Ø§Ø¨Ø±
                    </p>
                </div>
            </div>
            
            <div id="specialMission">
                <!-- Ù…Ø£Ù…ÙˆØ±ÛŒØª ÙˆÛŒÚ˜Ù‡ Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
                <div style="text-align: center; padding: 20px;">
                    <div class="loader" style="margin: 0 auto 15px;"></div>
                    <div style="color: var(--text-secondary);">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
                </div>
            </div>
        </div>
        
        <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ -->
        <div class="card" style="margin-top: 40px;">
            <h3 style="margin-bottom: 15px;">ğŸ’¡ Ù†Ú©Ø§Øª Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="color: var(--primary); font-size: 20px;">â°</div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</div>
                        <div style="color: var(--text-secondary); font-size: 13px;">Ù‡Ø± Û²Û´ Ø³Ø§Ø¹Øª Ø±ÛŒØ³Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="color: var(--success); font-size: 20px;">ğŸ’°</div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Ù¾Ø§Ø¯Ø§Ø´â€ŒÙ‡Ø§</div>
                        <div style="color: var(--text-secondary); font-size: 13px;">Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ù¾Ø³ Ø§Ø² ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="color: var(--accent); font-size: 20px;">âš¡</div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡</div>
                        <div style="color: var(--text-secondary); font-size: 13px;">Ù¾Ø§Ø¯Ø§Ø´â€ŒÙ‡Ø§ÛŒ ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="color: var(--secondary); font-size: 20px;">ğŸ¯</div>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Ù¾ÛŒØ´Ø±ÙØª Ø®ÙˆØ¯Ú©Ø§Ø±</div>
                        <div style="color: var(--text-secondary); font-size: 13px;">Ø¨Ø±Ø®ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± ØªÚ©Ù…ÛŒÙ„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="utils.js"></script>
    
    <script>
        // ==================== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ ====================
        let currentUser = null;
        let userMissions = [];
        let allMissions = [];
        let currentFilter = 'all';
        
        // Ù„ÛŒØ³Øª Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§
        const MISSIONS_DATA = {
            daily: [
                {
                    id: 'daily_login',
                    type: 'daily',
                    title: 'ÙˆØ±ÙˆØ¯ Ø±ÙˆØ²Ø§Ù†Ù‡',
                    description: 'Ù‡Ø± Ø±ÙˆØ² ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯ Ùˆ Ù¾Ø§Ø¯Ø§Ø´ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯',
                    icon: 'ğŸ“…',
                    reward: { type: 'sod', amount: 10000 },
                    goal: 1,
                    progress: 0,
                    completed: false,
                    claimed: false,
                    autoComplete: true
                },
                {
                    id: 'mine_1000',
                    type: 'daily',
                    title: 'Ø§Ø³ØªØ®Ø±Ø§Ø¬ Û±,Û°Û°Û° SOD',
                    description: 'Ø¯Ø± Ø·ÙˆÙ„ Ø§Ù…Ø±ÙˆØ² Û±,Û°Û°Û° SOD Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù†ÛŒØ¯',
                    icon: 'â›ï¸',
                    reward: { type: 'sod', amount: 5000 },
                    goal: 1000,
                    progress: 0,
                    completed: false,
                    claimed: false
                },
                {
                    id: 'click_50',
                    type: 'daily',
                    title: 'ÛµÛ° Ú©Ù„ÛŒÚ©',
                    description: 'ÛµÛ° Ø¨Ø§Ø± Ø±ÙˆÛŒ Ù…Ø§ÛŒÙ†Ø± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯',
                    icon: 'ğŸ–±ï¸',
                    reward: { type: 'sod', amount: 2500 },
                    goal: 50,
                    progress: 0,
                    completed: false,
                    claimed: false
                },
                {
                    id: 'claim_usdt',
                    type: 'daily',
                    title: 'Ø¯Ø±ÛŒØ§ÙØª USDT',
                    description: 'Ø­Ø¯Ø§Ù‚Ù„ Û°.Û°Û°Û± USDT Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯',
                    icon: 'ğŸ’°',
                    reward: { type: 'sod', amount: 15000 },
                    goal: 1,
                    progress: 0,
                    completed: false,
                    claimed: false
                }
            ],
            
            weekly: [
                {
                    id: 'mine_100k',
                    type: 'weekly',
                    title: 'Ø§Ø³ØªØ®Ø±Ø§Ø¬ Û±Û°Û°,Û°Û°Û° SOD',
                    description: 'Ø¯Ø± Ø·ÙˆÙ„ Ù‡ÙØªÙ‡ Û±Û°Û°,Û°Û°Û° SOD Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù†ÛŒØ¯',
                    icon: 'âš¡',
                    reward: { type: 'sod', amount: 50000 },
                    goal: 100000,
                    progress: 0,
                    completed: false,
                    claimed: false,
                    featured: true
                },
                {
                    id: 'level_up',
                    type: 'weekly',
                    title: 'Ø§Ø±ØªÙ‚Ø§Ø¡ Ø³Ø·Ø­',
                    description: 'Ø³Ø·Ø­ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±ØªÙ‚Ø§Ø¡ Ø¯Ù‡ÛŒØ¯',
                    icon: 'â­',
                    reward: { type: 'usdt', amount: 0.01 },
                    goal: 1,
                    progress: 0,
                    completed: false,
                    claimed: false
                },
                {
                    id: 'invite_friend',
                    type: 'weekly',
                    title: 'Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³Øª',
                    description: 'ÛŒÚ© Ø¯ÙˆØ³Øª Ø±Ø§ Ø¯Ø¹ÙˆØª Ú©Ù†ÛŒØ¯',
                    icon: 'ğŸ‘¥',
                    reward: { type: 'sod', amount: 100000 },
                    goal: 1,
                    progress: 0,
                    completed: false,
                    claimed: false
                }
            ],
            
            special: [
                {
                    id: 'special_mine_1m',
                    type: 'special',
                    title: 'Ø§Ø³ØªØ®Ø±Ø§Ø¬ Û±,Û°Û°Û°,Û°Û°Û° SOD',
                    description: 'ÛŒÚ© Ù…ÛŒÙ„ÛŒÙˆÙ† SOD Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù†ÛŒØ¯',
                    icon: 'ğŸ†',
                    reward: { type: 'usdt', amount: 0.1 },
                    goal: 1000000,
                    progress: 0,
                    completed: false,
                    claimed: false,
                    featured: true
                },
                {
                    id: 'complete_10_missions',
                    type: 'special',
                    title: 'ØªÚ©Ù…ÛŒÙ„ Û±Û° Ù…Ø£Ù…ÙˆØ±ÛŒØª',
                    description: 'Û±Û° Ù…Ø£Ù…ÙˆØ±ÛŒØª Ù…Ø®ØªÙ„Ù Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†ÛŒØ¯',
                    icon: 'ğŸ¯',
                    reward: { type: 'sod', amount: 250000 },
                    goal: 10,
                    progress: 0,
                    completed: false,
                    claimed: false
                },
                {
                    id: 'reach_level_10',
                    type: 'special',
                    title: 'Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ø³Ø·Ø­ Û±Û°',
                    description: 'Ø³Ø·Ø­ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Û±Û° Ø¨Ø±Ø³Ø§Ù†ÛŒØ¯',
                    icon: 'ğŸ‘‘',
                    reward: { type: 'usdt', amount: 0.5 },
                    goal: 10,
                    progress: 0,
                    completed: false,
                    claimed: false
                }
            ]
        };
        
        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        
        async function initMissions() {
            try {
                // Ø¨Ø±Ø±Ø³ÛŒ session
                const { data: { session } } = await window.supabaseClient.auth.getSession();
                
                if (!session) {
                    window.location.href = 'index.html';
                    return;
                }
                
                currentUser = session.user;
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
                await loadUserMissions();
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÛŒØ´Ø±ÙØª
                await loadGameData();
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                updateMissionsUI();
                
                console.log('âœ… Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§:', error);
                showError('Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ Ù¾ÛŒØ´ Ø¢Ù…Ø¯');
            }
        }
        
        async function loadUserMissions() {
            try {
                // Ø¯Ø±ÛŒØ§ÙØª Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                const { data, error } = await window.supabaseClient
                    .from('missions')
                    .select('*')
                    .eq('user_id', currentUser.id);
                
                if (error) throw error;
                
                userMissions = data || [];
                
                // Ø§Ú¯Ø± Ù…Ø£Ù…ÙˆØ±ÛŒØªÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†
                if (userMissions.length === 0) {
                    await createInitialMissions();
                    await loadUserMissions(); // Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±:', error);
                userMissions = [];
            }
        }
        
        async function createInitialMissions() {
            try {
                const missionsToCreate = [];
                
                // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ ØªÙ…Ø§Ù… Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§
                Object.values(MISSIONS_DATA).forEach(category => {
                    category.forEach(mission => {
                        missionsToCreate.push({
                            user_id: currentUser.id,
                            mission_id: mission.id,
                            progress: 0,
                            completed: false,
                            claimed: false,
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString()
                        });
                    });
                });
                
                // Ø¯Ø±Ø¬ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                const { error } = await window.supabaseClient
                    .from('missions')
                    .insert(missionsToCreate);
                
                if (error) throw error;
                
                console.log('âœ… Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡:', error);
            }
        }
        
        async function loadGameData() {
            try {
                const { data, error } = await window.supabaseClient
                    .from('game_data')
                    .select('total_mined, user_level, today_earnings')
                    .eq('user_id', currentUser.id)
                    .single();
                
                if (error) throw error;
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
                calculateMissionProgress(data);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒ:', error);
            }
        }
        
        function calculateMissionProgress(gameData) {
            // Ø§ÛŒÙ†Ø¬Ø§ Ù…Ù†Ø·Ù‚ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
            // Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø¨Ø§ÛŒØ¯ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´ÙˆØ¯
        }
        
        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI ====================
        
        function updateMissionsUI() {
            updateStats();
            renderMissionsList();
            renderSpecialMission();
        }
        
        function updateStats() {
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø±
            const completed = userMissions.filter(m => m.completed).length;
            const active = userMissions.filter(m => !m.completed && !m.claimed).length;
            const claimable = userMissions.filter(m => m.completed && !m.claimed).length;
            
            // ØªØ®Ù…ÛŒÙ† Ú©Ù„ Ù¾Ø§Ø¯Ø§Ø´â€ŒÙ‡Ø§
            let totalRewards = 0;
            userMissions.forEach(mission => {
                const missionData = getMissionData(mission.mission_id);
                if (missionData && mission.completed) {
                    totalRewards += missionData.reward.amount;
                }
            });
            
            // Ø¢Ù¾Ø¯ÛŒØª UI
            document.getElementById('completedMissions').textContent = completed;
            document.getElementById('activeMissions').textContent = active;
            document.getElementById('availableRewards').textContent = claimable;
            document.getElementById('totalRewards').textContent = window.NumberUtils.formatNumber(totalRewards) + ' SOD';
        }
        
        function renderMissionsList() {
            const container = document.getElementById('missionsList');
            
            // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§
            let filteredMissions = getAllMissions();
            
            if (currentFilter !== 'all') {
                filteredMissions = filteredMissions.filter(mission => {
                    if (currentFilter === 'completed') {
                        return mission.completed && !mission.claimed;
                    }
                    return mission.type === currentFilter;
                });
            }
            
            if (filteredMissions.length === 0) {
                container.innerHTML = `
                    <div class="mission-card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“­</div>
                        <h3 style="margin-bottom: 10px;">Ù‡ÛŒÚ† Ù…Ø£Ù…ÙˆØ±ÛŒØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
                        <p style="color: var(--text-secondary);">
                            ${currentFilter === 'completed' ? 'Ù‡Ù†ÙˆØ² Ù…Ø£Ù…ÙˆØ±ÛŒØªÛŒ ØªÚ©Ù…ÛŒÙ„ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯!' : 'Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.'}
                        </p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredMissions.forEach(mission => {
                const missionData = getMissionData(mission.mission_id) || {};
                const progressPercent = Math.min((mission.progress / missionData.goal) * 100, 100);
                
                // ØªØ¹ÛŒÛŒÙ† Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Øª
                const cardClasses = ['mission-card'];
                if (missionData.featured) cardClasses.push('featured');
                if (mission.completed) cardClasses.push('completed');
                if (mission.claimed) cardClasses.push('claimed');
                
                // ØªØ¹ÛŒÛŒÙ† Ø¯Ú©Ù…Ù‡
                let buttonHtml = '';
                let buttonClass = '';
                let buttonText = '';
                let buttonAction = '';
                
                if (mission.claimed) {
                    buttonClass = 'btn-completed';
                    buttonText = '<i class="fas fa-check"></i> Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡';
                    buttonAction = 'javascript:void(0)';
                } else if (mission.completed) {
                    buttonClass = 'btn-claim';
                    buttonText = '<i class="fas fa-gift"></i> Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø¯Ø§Ø´';
                    buttonAction = `claimMission('${mission.mission_id}')`;
                } else if (missionData.autoComplete) {
                    buttonClass = 'btn-start';
                    buttonText = '<i class="fas fa-play"></i> Ø´Ø±ÙˆØ¹ Ø®ÙˆØ¯Ú©Ø§Ø±';
                    buttonAction = `startMission('${mission.mission_id}')`;
                } else {
                    buttonClass = 'btn-start';
                    buttonText = '<i class="fas fa-play"></i> Ø´Ø±ÙˆØ¹ Ù…Ø£Ù…ÙˆØ±ÛŒØª';
                    buttonAction = `startMission('${mission.mission_id}')`;
                }
                
                html += `
                    <div class="${cardClasses.join(' ')}">
                        <div class="mission-badge badge-${missionData.type}">
                            ${missionData.type === 'daily' ? 'Ø±ÙˆØ²Ø§Ù†Ù‡' : 
                              missionData.type === 'weekly' ? 'Ù‡ÙØªÚ¯ÛŒ' : 'ÙˆÛŒÚ˜Ù‡'}
                        </div>
                        
                        <div class="mission-header">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <div style="font-size: 24px;">${missionData.icon}</div>
                                <h3 class="mission-title">${missionData.title}</h3>
                            </div>
                            <p class="mission-description">${missionData.description}</p>
                        </div>
                        
                        <div class="mission-reward">
                            <div class="reward-icon">
                                ${missionData.reward.type === 'usdt' ? 'ğŸ’' : 'ğŸ’°'}
                            </div>
                            <div class="reward-info">
                                <div class="reward-title">Ù¾Ø§Ø¯Ø§Ø´</div>
                                <div class="reward-amount">
                                    ${missionData.reward.type === 'usdt' 
                                        ? missionData.reward.amount.toFixed(4) + ' USDT'
                                        : window.NumberUtils.formatNumber(missionData.reward.amount) + ' SOD'}
                                </div>
                            </div>
                        </div>
                        
                        <div class="mission-progress">
                            <div class="progress-info">
                                <span>Ù¾ÛŒØ´Ø±ÙØª</span>
                                <span>${window.NumberUtils.formatNumber(mission.progress)} / ${window.NumberUtils.formatNumber(missionData.goal)}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                        
                        <div class="mission-actions">
                            <button class="mission-btn ${buttonClass}" onclick="${buttonAction}">
                                ${buttonText}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function renderSpecialMission() {
            const container = document.getElementById('specialMission');
            
            // Ø§Ù†ØªØ®Ø§Ø¨ ÛŒÚ© Ù…Ø£Ù…ÙˆØ±ÛŒØª ÙˆÛŒÚ˜Ù‡ ØªØµØ§Ø¯ÙÛŒ
            const specialMissions = MISSIONS_DATA.special.filter(m => !m.featured);
            const randomMission = specialMissions[Math.floor(Math.random() * specialMissions.length)];
            
            if (!randomMission) return;
            
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø£Ù…ÙˆØ±ÛŒØª
            const userMission = userMissions.find(m => m.mission_id === randomMission.id);
            
            const progress = userMission?.progress || 0;
            const completed = userMission?.completed || false;
            const claimed = userMission?.claimed || false;
            const progressPercent = Math.min((progress / randomMission.goal) * 100, 100);
            
            let buttonHtml = '';
            
            if (claimed) {
                buttonHtml = `
                    <button class="mission-btn btn-completed" style="margin-top: 15px;">
                        <i class="fas fa-check"></i> Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡
                    </button>
                `;
            } else if (completed) {
                buttonHtml = `
                    <button class="mission-btn btn-claim" style="margin-top: 15px;" onclick="claimMission('${randomMission.id}')">
                        <i class="fas fa-gift"></i> Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø¯Ø§Ø´ Ø¯ÙˆØ¨Ø±Ø§Ø¨Ø±!
                    </button>
                `;
            } else {
                buttonHtml = `
                    <button class="mission-btn btn-start" style="margin-top: 15px;" onclick="startMission('${randomMission.id}')">
                        <i class="fas fa-bolt"></i> Ø´Ø±ÙˆØ¹ Ú†Ø§Ù„Ø´ ÙˆÛŒÚ˜Ù‡
                    </button>
                `;
            }
            
            container.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <div style="font-size: 20px; font-weight: 700;">${randomMission.title}</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">${randomMission.description}</div>
                    </div>
                    <div style="font-size: 32px;">${randomMission.icon}</div>
                </div>
                
                <div class="mission-progress">
                    <div class="progress-info">
                        <span>Ù¾ÛŒØ´Ø±ÙØª</span>
                        <span>${window.NumberUtils.formatNumber(progress)} / ${window.NumberUtils.formatNumber(randomMission.goal)}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%"></div>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin: 20px 0; padding: 15px; background: rgba(255, 107, 53, 0.1); border-radius: var(--radius);">
                    <div style="font-size: 24px;">ğŸ</div>
                    <div>
                        <div style="font-weight: 600;">Ù¾Ø§Ø¯Ø§Ø´ ÙˆÛŒÚ˜Ù‡ Ø§Ù…Ø±ÙˆØ²</div>
                        <div style="font-size: 20px; font-weight: 900; color: var(--accent);">
                            ${randomMission.reward.type === 'usdt' 
                                ? (randomMission.reward.amount * 2).toFixed(4) + ' USDT'
                                : window.NumberUtils.formatNumber(randomMission.reward.amount * 2) + ' SOD'}
                            <span style="font-size: 12px; color: var(--text-secondary); margin-right: 5px;">(Ø¯ÙˆØ¨Ø±Ø§Ø¨Ø±!)</span>
                        </div>
                    </div>
                </div>
                
                ${buttonHtml}
            `;
        }
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…Ù„ÛŒØ§ØªÛŒ ====================
        
        function filterMissions(filter) {
            // Ø¢Ù¾Ø¯ÛŒØª ØªØ¨â€ŒÙ‡Ø§
            document.querySelectorAll('.mission-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentFilter = filter;
            renderMissionsList();
        }
        
        async function startMission(missionId) {
            try {
                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù…Ø£Ù…ÙˆØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±
                const missionIndex = userMissions.findIndex(m => m.mission_id === missionId);
                
                if (missionIndex === -1) {
                    showError('Ù…Ø£Ù…ÙˆØ±ÛŒØª ÛŒØ§ÙØª Ù†Ø´Ø¯');
                    return;
                }
                
                const mission = userMissions[missionIndex];
                const missionData = getMissionData(missionId);
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø³Øª
                if (missionData.autoComplete) {
                    // Ø¨Ø±Ø§ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø«Ù„ ÙˆØ±ÙˆØ¯ Ø±ÙˆØ²Ø§Ù†Ù‡
                    mission.progress = missionData.goal;
                    mission.completed = true;
                    
                    // Ø¢Ù¾Ø¯ÛŒØª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                    await updateMissionInDB(mission);
                    
                    showMessage('Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!', 'success');
                    
                } else {
                    // Ø¨Ø±Ø§ÛŒ Ù…Ø£Ù…ÙˆØ±ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¹Ù…ÙˆÙ„ÛŒ
                    showMessage('Ù…Ø£Ù…ÙˆØ±ÛŒØª Ø´Ø±ÙˆØ¹ Ø´Ø¯! Ù¾ÛŒØ´Ø±ÙØª Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ù†Ø¨Ø§Ù„ Ú©Ù†ÛŒØ¯', 'info');
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                updateMissionsUI();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø´Ø±ÙˆØ¹ Ù…Ø£Ù…ÙˆØ±ÛŒØª:', error);
                showError('Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø´Ø±ÙˆØ¹ Ù…Ø£Ù…ÙˆØ±ÛŒØª Ù¾ÛŒØ´ Ø¢Ù…Ø¯');
            }
        }
        
        async function claimMission(missionId) {
            try {
                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù…Ø£Ù…ÙˆØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±
                const missionIndex = userMissions.findIndex(m => m.mission_id === missionId);
                
                if (missionIndex === -1) {
                    showError('Ù…Ø£Ù…ÙˆØ±ÛŒØª ÛŒØ§ÙØª Ù†Ø´Ø¯');
                    return;
                }
                
                const mission = userMissions[missionIndex];
                const missionData = getMissionData(missionId);
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ù…Ø£Ù…ÙˆØ±ÛŒØª Ú©Ø§Ù…Ù„ Ø´Ø¯Ù‡
                if (!mission.completed) {
                    showError('Ù…Ø£Ù…ÙˆØ±ÛŒØª Ù‡Ù†ÙˆØ² Ú©Ø§Ù…Ù„ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª');
                    return;
                }
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡
                if (mission.claimed) {
                    showError('Ø§ÛŒÙ† Ù¾Ø§Ø¯Ø§Ø´ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡ Ø§Ø³Øª');
                    return;
                }
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾Ø§Ø¯Ø§Ø´ (Ø§Ú¯Ø± ÙˆÛŒÚ˜Ù‡ Ø§Ù…Ø±ÙˆØ² Ø§Ø³ØªØŒ Ø¯ÙˆØ¨Ø±Ø§Ø¨Ø± Ú©Ù†)
                let rewardAmount = missionData.reward.amount;
                const isSpecialToday = document.querySelector('.mission-card.featured') !== null;
                
                if (isSpecialToday && missionData.type === 'special') {
                    rewardAmount *= 2;
                }
                
                // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒ Ú©Ø§Ø±Ø¨Ø±
                const { data: gameData, error: gameError } = await window.supabaseClient
                    .from('game_data')
                    .select('sod_balance, usdt_balance')
                    .eq('user_id', currentUser.id)
                    .single();
                
                if (gameError) throw gameError;
                
                // Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø§Ø¯Ø§Ø´ Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
                if (missionData.reward.type === 'usdt') {
                    const newUSDT = (gameData.usdt_balance || 0) + rewardAmount;
                    
                    await window.supabaseClient
                        .from('game_data')
                        .update({ usdt_balance: newUSDT })
                        .eq('user_id', currentUser.id);
                    
                    // Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´
                    await window.supabaseClient
                        .from('transactions')
                        .insert([{
                            user_id: currentUser.id,
                            description: `Ù¾Ø§Ø¯Ø§Ø´ Ù…Ø£Ù…ÙˆØ±ÛŒØª: ${missionData.title}`,
                            amount: rewardAmount,
                            type: 'usdt',
                            created_at: new Date().toISOString()
                        }]);
                    
                } else {
                    const newSOD = (gameData.sod_balance || 0) + rewardAmount;
                    
                    await window.supabaseClient
                        .from('game_data')
                        .update({ 
                            sod_balance: newSOD,
                            total_mined: (gameData.total_mined || 0) + rewardAmount
                        })
                        .eq('user_id', currentUser.id);
                    
                    // Ø«Ø¨Øª ØªØ±Ø§Ú©Ù†Ø´
                    await window.supabaseClient
                        .from('transactions')
                        .insert([{
                            user_id: currentUser.id,
                            description: `Ù¾Ø§Ø¯Ø§Ø´ Ù…Ø£Ù…ÙˆØ±ÛŒØª: ${missionData.title}`,
                            amount: rewardAmount,
                            type: 'sod',
                            created_at: new Date().toISOString()
                        }]);
                }
                
                // Ø¢Ù¾Ø¯ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ù…Ø£Ù…ÙˆØ±ÛŒØª
                mission.claimed = true;
                await updateMissionInDB(mission);
                
                // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙÙ‚ÛŒØª
                const rewardText = missionData.reward.type === 'usdt'
                    ? rewardAmount.toFixed(4) + ' USDT'
                    : window.NumberUtils.formatNumber(rewardAmount) + ' SOD';
                
                showMessage(`ğŸ‰ Ù¾Ø§Ø¯Ø§Ø´ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯! ${rewardText}`, 'success');
                
                // Ø§ÙÚ©Øª
                window.Effects?.createConfetti();
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
                updateMissionsUI();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø¯Ø§Ø´:', error);
                showError('Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø¯Ø§Ø´ Ù¾ÛŒØ´ Ø¢Ù…Ø¯');
            }
        }
        
        async function updateMissionInDB(mission) {
            try {
                const { error } = await window.supabaseClient
                    .from('missions')
                    .update({
                        progress: mission.progress,
                        completed: mission.completed,
                        claimed: mission.claimed,
                        updated_at: new Date().toISOString()
                    })
                    .eq('user_id', currentUser.id)
                    .eq('mission_id', mission.mission_id);
                
                if (error) throw error;
                
                // Ø¢Ù¾Ø¯ÛŒØª Ø¯Ø± Ø¢Ø±Ø§ÛŒÙ‡ Ù…Ø­Ù„ÛŒ
                const index = userMissions.findIndex(m => 
                    m.mission_id === mission.mission_id
                );
                
                if (index !== -1) {
                    userMissions[index] = mission;
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ø¯ÛŒØª Ù…Ø£Ù…ÙˆØ±ÛŒØª:', error);
                throw error;
            }
        }
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
        
        function getAllMissions() {
            const allMissions = [];
            
            userMissions.forEach(userMission => {
                const missionData = getMissionData(userMission.mission_id);
                if (missionData) {
                    allMissions.push({
                        ...userMission,
                        ...missionData,
                        type: missionData.type
                    });
                }
            });
            
            return allMissions;
        }
        
        function getMissionData(missionId) {
            // Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± ØªÙ…Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
            for (const category of Object.values(MISSIONS_DATA)) {
                const mission = category.find(m => m.id === missionId);
                if (mission) return mission;
            }
            return null;
        }
        
        function showMessage(message, type = 'info') {
            const colors = {
                success: '#00C853',
                error: '#FF3D00',
                info: '#0066FF',
                warning: '#FFB300'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--card);
                border: 1px solid var(--glass-border);
                border-left: 4px solid ${colors[type] || colors.info};
                border-radius: var(--radius);
                padding: 15px 20px;
                display: flex;
                align-items: center;
                gap: 15px;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                max-width: 400px;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 20px;">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</div>
                <div>
                    <div style="font-weight: bold;">${type === 'success' ? 'Ù…ÙˆÙÙ‚ÛŒØª' : type === 'error' ? 'Ø®Ø·Ø§' : type === 'warning' ? 'Ù‡Ø´Ø¯Ø§Ø±' : 'Ø§Ø·Ù„Ø§Ø¹'}</div>
                    <div style="color: var(--text-secondary); font-size: 14px;">${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function showError(message) {
            showMessage(message, 'error');
        }
        
        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            initMissions();
            
            // Ø±ÙØ±Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
            setInterval(() => {
                if (currentUser) {
                    loadUserMissions().then(updateMissionsUI);
                }
            }, 30000);
        });
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ÛŒ CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
            
            @keyframes pulse {
                0%, 100% {
                    transform: scale(1);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.1);
                    opacity: 0.8;
                }
            }
            
            .mission-card.featured {
                animation: pulse 2s infinite;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
